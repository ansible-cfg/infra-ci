- name: create logs folder
  become: yes
  file:
    path: /volumes/gitlab/logs
    state: directory
    
- name: create data folder
  become: yes
  file:
    path: /volumes/gitlab/data
    state: directory

- name: Install gitlab container
  become: yes
  docker_container:
    name: gitlab-ci
    image: sameersbn/gitlab:10.3.3
    state: started
    ports:
        - "10022:22"
        - "10080:80"
        - "10443:443"
    volumes:
      - /volumes/gitlab/logs:/var/log/gitlab
      - /volumes/gitlab/data:/home/git/data
    env:
        GITLAB_HOST: "{{ CI_GITLAB_HOST }}"
        REDIS_HOST: "{{ CI_REDIS_HOST }}"
        REDIS_PORT: "{{ CI_REDIS_PORT }}"
        DB_ADAPTER: postgresql
        DB_HOST: "{{ CI_DB_HOST }}"
        DB_PORT: "{{ CI_DB_PORT }}"
        DB_NAME: "{{ CI_DB_NAME }}"
        DB_USER: "{{ CI_DB_USER }}"
        DB_PASS: "{{ CI_DB_PASSWORD }}"
        GITLAB_SIGNUP_ENABLED: false
        GITLAB_SECRETS_DB_KEY_BASE: sie_phae1Mavomahthahxafivueraihu
        GITLAB_SECRETS_SECRET_KEY_BASE: ru9Iesh!oopaedayeaghofuingaethungimaeyohyohmukewediewaeshovohtej
        GITLAB_SECRETS_OTP_KEY_BASE: aeVi7ja.maquooliacolietevaloowahfohkaeviesaeshahfohfueneraseeyun